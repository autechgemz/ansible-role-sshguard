---

- name: Install tasks
  tags:
    - sshguard_install
    - sshguard
  become: true
  block:
    - name: Install EPEL repository
      ansible.builtin.yum:
        name: [ "epel-release" ]
        state: present
      when:
        - ansible_os_family == 'RedHat'
        - sshguard_repos is defined and sshguard_repos
    - name: Install sshguard package
      ansible.builtin.yum:
        name: [ "{{ item }}" ]
        state: "{{ sshguard_package_ensure }}" 
      with_items: "{{ sshguard_package_name }}"
      when: ansible_os_family == 'RedHat'
    - name: Install sshguard package
      ansible.builtin.apt:
        name: [ "{{ item }}" ]
        state: "{{ sshguard_package_ensure }}" 
        force_apt_get: true
      with_items: "{{ sshguard_package_name }}"
      when: ansible_os_family == 'Debian'
